TASK-O-MATIC API 
===
[![Build Status](https://travis-ci.org/slugbyte/taskomatic-api.svg?branch=master)](https://travis-ci.org/slugbyte/taskomatic-api)

A proof of concept task management API.

## SECURITY CONCERNS
Unless this application is protected with an HTTPS connection, the requests and responses will be subject to man in the middle attacks and snooping.
In production the application should be deployed behind an HTTPS-Proxy server to prevent misuse.

## DEVELOPMENT SETUP
### Access the source
Run the following commands.
1. `git clone https://github.com/slugbyte/taskomatic-api.git` will download the source
1. `npm install` will install the dependent node modules.

### Setup external dependencies 
* Redis server

### Configure the environment
* Create a `.env` file in the root directory of this repo based on the following example file.

``` bash
PORT=3000
API_URL='http://localhost:3000'
CORS_ORIGIN='http://localhost:8080'
APP_SECRET='top secret key (in production this should be an RSA key'
REDIS_URI='redis://localhost:6379'
DEBUG=app:* 
EMAIL_SMTP=smtp.ethereal.email
EMAIL_PORT=587
EMAIL_USER='tobin.hoeger@ethereal.email'
EMAIL_PASS='zDm8pm8vMV4A6yv1FE'
```

### Run the development test
The following commands will execute the test-suite.
* `npm run test` -- this command will run the test-suite one time.

### Start the rest api service
Run the following command to boot the server.
* `npm run start` -- this command will boot the server using [pm2](https://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/).
  * checkout the [pm2](https://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/) docs if you are not familiar

### start the mail service
Run the following command to boot the mail server
* `npm run start-mailer` -- this command will boot the server using [pm2](https://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/).
  * checkout the [pm2](https://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/) docs if you are not familiar

## MODELS
Below are descriptions of the taskomatic data models.

### USER
Below is a list of the User-Model properties, along with their descriptions.  
* `uuid` - a unique idenifire for the user
* `id` - the key used to store the user into redis
  * formated `user:${email}`
* `email` - the user's email 
* `username` - the users username
  * must be 8 chars long
* `firstName` - the users first name
* `lastName` - the users last name
* `passwordHash` - a bcrypt hash of the users password (NEVER STORING PLAIN TEXT PASSWORDS)
* `verified` - a boolean value that states if the users email has been verified

### TASK

The Task model has full CRUD opperations. Each task initially belongs to the user that created it, 
but can be reassigned to a differnt registerd account.

Below is a list of the Task-Model properties, along with their descriptions.  
* `uuid` - a unique identifier for the task.
* `id` - the key used to store the user into redis.
  * formated `task:${user.email}:${task.uuid}`
* `listID` - an identifier that can be used to query for other tasks in the same list.
  * formated `list:${user.email}`
* `userID` - the user who ownes the tasks id.
  * formated `user:${user.email}` 
* `description` - a description of the task.
* `timestamp` - a date object generated by the server when the task was created.
* `completed` - a boolean value indicating if the task is done.
* `draft` - a boolean value indicating if the task is a draft.

## API Interface 
The Taskomatic API implements a REST interface. Each endpoint allows an http-client to create, read, update, and delete (CRUD) a model using HTTP the appropiate HTTP methods. 

## AUTH
The `/auth` endpoint is used to manage the CRUD operations of User-Model, as well as generate authentication tokens.

### POST /auth
Create a user and recieve an authentication token.
#### Requirements
* Make a HTTP POST request to `/auth` 
* Set the HTTP header `Content-Type` to `application/json`
* Attach JSON to the body of the request with the following data.
``` json
{
  "firstName": "Nancy",
  "lastName": "Doe",
  "email": "example@example.com",
  "username": "8charlengthrequired",
  "password": "mustbe8charslong"
}
```

#### Response
The server will return a JSON object that contains an authentication token, that can be used to make task requests.
``` json
{
  "authToken": "ZXhhbXBsZSB0b2tlbiBleGFtcGxlIHRva2VuIGV4YW1wbGUgdG9rZW4K",
}
```

### GET /auth
Retrieve an authentication token for an existing user. 
#### Requirements
* Make a HTTP GET requst to `/auth`
* add an Authorization header with Basic Auth
  * `Authorization: Basic [email]:[password]`

#### Response
The server will return a JSON object that contains an authentication token, that can be used to make task requests.
``` json
{
  "authToken": "ZXhhbXBsZSB0b2tlbiBleGFtcGxlIHRva2VuIGV4YW1wbGUgdG9rZW4K",
}
```


### PUT /auth
Update a user's password.

#### Requirements
* Make a HTTP PUT requst to `/auth`
* add an Authorization header with Basic Auth
  * `Authorization: Bearer [token]

#### Response

### DELETE /auth
Delete a user and all of their content.
#### Requirements
#### Response


## TASK 
The `task` endpoint is used to manage the CRUD opperations of the task model.
### POST /task
#### Requirements
#### Response

### GET /task
#### Requirements
#### Response

### GET /task/:id
#### Requirements
#### Response

### UPDATE /task/:id
#### Requirements
#### Response

### DELETE /task/:id
#### Requirements
#### Response

## RANDOM TASK

The `/task/random` endpoint is used to manage the CRUD operations of the Task-Model, with the added side effect that it will automatically be marked as completed after a random interval within 10 seconds.
### POST /task/random
#### Requirements
#### Response

# The Mail service
![](/asset/mailer.png)

